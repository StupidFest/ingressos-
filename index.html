<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Ingressos 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(120deg, #5b06b8, #1e8fe3);
  color: white;
  display: flex; justify-content: center; align-items: center;
  min-height: 100vh; flex-direction: column;
}
.container {
  background: rgba(255,255,255,0.1);
  padding: 25px; border-radius: 14px;
  width: 95%; max-width: 400px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}
input, select {
  width: 100%; padding: 10px; margin: 8px 0;
  border-radius: 8px; border: none;
}
button {
  background: linear-gradient(90deg, #00c9a7, #92fe9d);
  border: none; color: #04203a;
  padding: 10px 15px; border-radius: 8px;
  cursor: pointer; width: 100%; font-weight: bold;
}
button:hover { transform: scale(1.03); }
.result {
  margin-top: 15px; padding: 10px; border-radius: 8px;
  background: rgba(0,0,0,0.2); word-wrap: break-word;
}
</style>
</head>
<body>
  <div class="container">
    <h2>üéüÔ∏è Gerar Ingresso</h2>
    <input id="nome" placeholder="Nome do participante" />
    <input id="valor" placeholder="Valor (ex: 50)" />
    <select id="tipo">
      <option value="">Tipo do ingresso</option>
      <option>VIP</option>
      <option>COMUM</option>
      <option>BACKSTAGE</option>
    </select>

    <label>üìÑ Upload do PDF do ingresso:</label>
    <input type="file" id="pdfFile" accept="application/pdf" />

    <label>üì∑ Upload do comprovante (opcional):</label>
    <input type="file" id="comprovanteFile" accept="image/*" />

    <button onclick="enviar()">üöÄ Gerar Ingresso</button>

    <div class="result" id="resultado"></div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzJuuQSfdkb0MbS9OClPrGDL8CjrqKi9U8PZF36il3gm6ISKaKACw3qKd9A3MAIZq62jQ/exec";

// converte arquivo em base64
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

async function enviar() {
  const nome = document.getElementById("nome").value.trim();
  const valor = document.getElementById("valor").value.trim();
  const tipo = document.getElementById("tipo").value.trim();
  const pdfFile = document.getElementById("pdfFile").files[0];
  const comprovanteFile = document.getElementById("comprovanteFile").files[0];
  const resEl = document.getElementById("resultado");
  resEl.innerHTML = "‚è≥ Enviando...";

  if (!nome || !valor || !tipo || !pdfFile) {
    resEl.innerHTML = "‚ö†Ô∏è Preencha todos os campos obrigat√≥rios e selecione um PDF.";
    return;
  }

  try {
    const pdfBase64 = await fileToBase64(pdfFile);
    const comprovanteBase64 = comprovanteFile ? await fileToBase64(comprovanteFile) : "";

    // Envia via JSONP
    const callbackName = "callback_" + Date.now();
    window[callbackName] = function(response) {
      if (response.ok) {
        resEl.innerHTML = `
          ‚úÖ Ingresso gerado com sucesso!<br>
          <b>C√≥digo:</b> ${response.codigo}<br>
          <a href="${response.pdfUrl}" target="_blank" style="color:#00ffcc;">Abrir PDF</a>
        `;
      } else {
        resEl.innerHTML = "‚ùå Erro: " + (response.error || "Erro desconhecido.");
      }
    };

    const params = new URLSearchParams({
      action: "generate",
      name: nome,
      value: valor,
      type: tipo,
      pdfBase64: pdfBase64,
      comprovante: comprovanteBase64,
      callback: callbackName
    });

    const script = document.createElement("script");
    script.src = `${API_URL}?${params.toString()}`;
    document.body.appendChild(script);

  } catch (err) {
    resEl.innerHTML = "‚ùå Erro ao processar arquivos: " + err.message;
  }
}
</script>
</body>
</html>
