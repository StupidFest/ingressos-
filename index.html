<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador de Ingressos 2025</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #4e54c8, #8f94fb);
  color: white;
  display: flex; justify-content: center; align-items: center;
  height: 100vh; flex-direction: column;
}
.container {
  background: rgba(255,255,255,0.1);
  padding: 25px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
input, select {
  width: 100%; padding: 10px; margin: 8px 0;
  border-radius: 8px; border: none;
}
button {
  background: #00ffcc; border: none; color: #003344;
  padding: 10px 15px; border-radius: 8px;
  font-weight: bold; cursor: pointer; width: 100%;
}
#qrcode { margin-top: 15px; }
#downloadBtn {
  display: none; margin-top: 10px;
  background: #1effac; color: #002b26;
}
</style>
</head>
<body>
  <div class="container">
    <h2>üéüÔ∏è Gerar Ingresso</h2>
    <input id="nome" placeholder="Nome do participante" />
    <input id="valor" placeholder="Valor (ex: 50)" />
    <select id="tipo">
      <option value="">Tipo do ingresso</option>
      <option>VIP</option>
      <option>COMUM</option>
      <option>BACKSTAGE</option>
    </select>
    <button onclick="gerarIngresso()">üöÄ Gerar</button>
    <div id="qrcode"></div>
    <button id="downloadBtn" onclick="baixarPDF()">üìÑ Baixar PDF</button>
    <div id="mensagem"></div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzJuuQSfdkb0MbS9OClPrGDL8CjrqKi9U8PZF36il3gm6ISKaKACw3qKd9A3MAIZq62jQ/exec";
let codigoGerado = "";
let nomeP = "", valorP = "", tipoP = "";

function gerarCodigo() {
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let code = "";
  for (let i = 0; i < 8; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
  return code;
}

async function gerarIngresso() {
  nomeP = document.getElementById("nome").value.trim();
  valorP = document.getElementById("valor").value.trim();
  tipoP = document.getElementById("tipo").value.trim();
  const msg = document.getElementById("mensagem");
  msg.innerHTML = "";

  if (!nomeP || !valorP || !tipoP) {
    msg.innerHTML = "‚ö†Ô∏è Preencha todos os campos.";
    return;
  }

  codigoGerado = gerarCodigo();
  document.getElementById("qrcode").innerHTML = "";
  new QRCode(document.getElementById("qrcode"), {
    text: codigoGerado,
    width: 180,
    height: 180,
    colorDark: "#000000",
    colorLight: "#ffffff",
  });

  document.getElementById("downloadBtn").style.display = "block";
  msg.innerHTML = "‚úÖ Ingresso gerado! C√≥digo: <b>" + codigoGerado + "</b>";

  // Enviar para a planilha (JSONP)
  const callbackName = "cb_" + Date.now();
  window[callbackName] = function(res) {
    if (!res.ok) msg.innerHTML += "<br>‚ùå Erro ao salvar: " + res.error;
    else msg.innerHTML += "<br>üìä Dados salvos na planilha!";
  };

  const params = new URLSearchParams({
    action: "generate",
    name: nomeP,
    value: valorP,
    type: tipoP,
    codigo: codigoGerado,
    callback: callbackName
  });
  const script = document.createElement("script");
  script.src = `${API_URL}?${params}`;
  document.body.appendChild(script);
}

async function baixarPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.setFontSize(20);
  pdf.text("üéüÔ∏è Ingresso Oficial 2025", 60, 20);
  pdf.setFontSize(14);
  pdf.text("Nome: " + nomeP, 20, 50);
  pdf.text("Tipo: " + tipoP, 20, 60);
  pdf.text("Valor: R$" + valorP, 20, 70);
  pdf.text("C√≥digo: " + codigoGerado, 20, 80);

  const qrCanvas = document.querySelector("#qrcode canvas");
  const imgData = qrCanvas.toDataURL("image/png");
  pdf.addImage(imgData, "PNG", 60, 90, 90, 90);

  pdf.save(`Ingresso_${nomeP}_${codigoGerado}.pdf`);
}
</script>
</body>
</html>
