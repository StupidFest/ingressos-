<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Validador de Ingressos</title>
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
body{font-family:Arial,sans-serif;background:#0d1117;color:#fff;text-align:center;margin:0;padding:20px}
h1{font-size:20px;margin:10px 0}
#reader{width:320px;margin:10px auto;border-radius:12px;overflow:hidden}
#result{margin-top:12px;font-size:18px}
button{margin-top:16px;padding:10px 16px;border:none;border-radius:8px;background:#0069ff;color:#fff;cursor:pointer;font-weight:700}
.ok{color:#00ff88;font-weight:700}
.warn{color:#ffd166;font-weight:700}
.err{color:#ff6b6b;font-weight:700}
</style>
</head>
<body>
<h1>üé• Validador de Ingressos</h1>
<div id="reader"></div>
<div id="result">Aponte a c√¢mera para o QR Code</div>
<button onclick="window.location.href='index.html'">‚¨ÖÔ∏è Voltar</button>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzZVETR1_gVv-ErwDtKPNn61k89PHUYCtujYeDD9NvuF2IiVEGhjqzT3CkwsG9UlVsMuA/exec";
function jsonp(params, cb){ const name = 'cb_'+Date.now()+'_'+Math.floor(Math.random()*10000); window[name] = function(resp){ cb(null,resp); delete window[name]; document.getElementById(name+'_s')?.remove(); }; const qs = new URLSearchParams({...params, callback: name}).toString(); const s = document.createElement('script'); s.src = API_URL + (API_URL.includes('?')? '&' : '?') + qs; s.id = name+'_s'; s.onerror = ()=>cb(new Error('JSONP failed')); document.body.appendChild(s); }
function show(msg, cls){ const el = document.getElementById('result'); el.className = cls; el.innerHTML = msg; }
function handleResponse(resp){ if(resp && resp.ok && resp.status === 'OK'){ show('‚úÖ INGRESSO CONFIRMADO<br><b>'+resp.nome+'</b><br>'+resp.tipo+' - R$'+resp.valor, 'ok'); } else if(resp && resp.ok && resp.status === 'USADO'){ show('‚ö†Ô∏è INGRESSO J√Å UTILIZADO', 'warn'); } else { show('‚ùå C√ìDIGO N√ÉO ENCONTRADO', 'err'); } }
function validateCode(code){ show('‚è≥ Validando...', ''); jsonp({ action: 'validate', codigo: code }, (err, resp)=>{ if(err){ show('‚ùå Erro rede', 'err'); return; } handleResponse(resp); }); }
const html5QrCode = new Html5Qrcode('reader');
Html5Qrcode.getCameras().then(cameras=>{ if(cameras && cameras.length){ const camId = cameras[0].id; html5QrCode.start(camId, { fps:10, qrbox:250 }, (decoded)=>{ html5QrCode.stop().then(()=>validateCode(decoded.trim())); }, (err)=>{} ).catch(e=>show('‚ùå Erro c√¢mera: '+e.message,'err')); } else { show('‚ùå Nenhuma c√¢mera detectada','err'); } }).catch(e=>show('‚ùå Erro ao obter c√¢meras','err'));
</script>
</body>
</html>
